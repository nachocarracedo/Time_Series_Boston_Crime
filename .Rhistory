season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
points(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,epredvalues,ylim=c(15,23),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
exp(preddata$fit)
#tail(bos.stlm$time.series[,'seasonal'],14)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
points(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,epredvalues,ylim=cc(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
lines(ti,fitted(trreg),col='red')
points(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
ti\
ti
fitted(trreg)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,epredvalues,ylim=cc(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,epredvalues,ylim=cc(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,epredvalues,ylim=c(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,exp(epredvalues),ylim=c(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,exp(epredvalues),ylim=c(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(predtime,exp(epredvalues),ylim=c(-5,800),col='red', type='l',lwd=2)
predtime
predtimeexp(epredvalues)exp(epredvalues)
exp(epredvalues)
plot(predtime,exp(spredvalues),ylim=c(-5,800),col='red', type='l',lwd=2)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(-5,800),xlim=c(1970,1977),type='l')
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(ti,bos.ts,ylim=c(-5,709),xlim=c(1970,1977),type='l')
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1970,1977),type='l')
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1970,1977),type='l',title="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1970,1977),type='l',main="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
bos.ts
bos.da$trend
bosdaresid=window(bos.da$random, start=c(1966,7), end=c(1975,4))
rmseda=sqrt(sum(bosdaresid^2)/length(bosdaresid))
#mul
resid=bos.ts-preddm
bosdmresid=window(resid, start=c(1966,7), end=c(1975,4))
rmsedm=sqrt(sum(bosdmresid^2)/length(bosdmresid))
print(paste("RMSE decomposition additive: ", rmseda))
print(paste("RMSE decomposition multiplicate model: ", rmsedm))
```{r, echo=FALSE}
tr=window(bos.dm$trend, start=c(1966,7), end=c(1975,4))
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2, main="Linear regression of the trend")
lines(ti,fitted(trreg),col='red',lwd=2)
```{r, echo=FALSE}
tr=window(bos.dm$trend, start=c(1966,7), end=c(1975,4))
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2, main="Linear regression of the trend",ylim=c(-5,550))
lines(ti,fitted(trreg),col='red',lwd=2)
```{r, echo=FALSE}
tr=window(bos.dm$trend, start=c(1966,7), end=c(1975,4))
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2, main="Linear regression of the trend",ylim=c(-5,450))
lines(ti,fitted(trreg),col='red',lwd=2)
```
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE, main= "Nov. 1975 and Dec. 1975")
preddata$fit
```
multiclicative model which yield a higher mrse. Below is the plot of regressing the trend over time:
```{r, echo=FALSE}
tr=window(bos.dm$trend, start=c(1966,7), end=c(1975,4))
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2, main="Linear regression of the trend",ylim=c(-5,450))
lines(ti,fitted(trreg),col='red',lwd=2)
```
**1.c. Generate forecasts for Nov. 1975 and Dec. 1975 using the best model determined in a. **
Now that we have our linear model we can use it to forecast values for Nov. 1975 and Dec. 1975:
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE, main= "Nov. 1975 and Dec. 1975")
preddata$fit
```
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
preddata$fit
data.frame(c(1975.833,1975.917),preddata$fit)
data.frame(c(1975.833,1975.917),preddata$fit, nrows=2)
?data.frame
data.frame(Time = c("Nov 1975","Dec 1975"),preddata$fit)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = preddata$fit)
data.frame(Time = c("Nov 1975   ","Dec 1975   "),Prediction = preddata$fit)
data.frame(Time = c("   Nov 1975","   Dec 1975"),Prediction = preddata$fit)
tail(tsbosd$time.series[,'seasonal'])
tail(bos.dm$time.series[,'seasonal'])
library(FinTS)
setwd('C:\\Users\\carrai1\\Desktop\\Master\\MA611_Time_Series\\Assigments\\3\\')
bos.df=scan(file='.\\Boston.dat')
bos.ts=ts(bos.df,start=c(1966,1),frequency=12)
```
In this document I'm going to apply different techniques to model the time series data for 'Number of armed robberies in Boston'. I'll also forecast values for November and December 1976.First, let's take a look a the data:
```{r, echo=FALSE}
bos.ts=ts(bos.df,start=c(1966,1),frequency=12)
plot(bos.ts, main="Armed robberies in Boston")
```
**1. Use the moving average decomposition models we discussed in class along with R (decompose). **
The first model I'll apply is the moving average decomposition model. There are to flavors of this model, additive and multiplicative. Let's apply both and compare results. On the next two plots we can see the model (red line) plotted on top of of data:
```{r, echo=FALSE}
bos.da=decompose(bos.ts,type='additive')
bos.dm=decompose(bos.ts,type='multiplicative')
```
Here is the decomposition (additive)
```{r, echo=FALSE}
predda=bos.da$trend+bos.da$seasonal
layout(1:1)
plot(bos.ts,lwd=2, main="Decomposition - Additive")
lines(predda,col='red',lwd=2)
```
```{r, echo=FALSE}
preddm=bos.dm$trend*bos.dm$seasonal
layout(1:1)
plot(bos.ts,lwd=2,main="Decomposition - Multiplicative")
lines(preddm,col='red',lwd=2)
```
It seems the multiplicative model fits the data better. But let's make sure using the mean root square error.
**1.a. Determine the best model to fit the data (justify your conclusion both in terms of the characteristics of the data and an evaluation of the fit).**
The best way to check how the model fits the data is to calculate the msqe. Also, it will allow us to compare models.
***NOTE*** We neen to average seasons so a few values at the begining and at the end will be lost (We won't be able to get them for our model)
Let's calculate mrse for both of our models:
```{r, echo=FALSE}
#ad
bosdaresid=window(bos.da$random, start=c(1966,7), end=c(1975,4))
rmseda=sqrt(sum(bosdaresid^2)/length(bosdaresid))
#mul
resid=bos.ts-preddm
bosdmresid=window(resid, start=c(1966,7), end=c(1975,4))
rmsedm=sqrt(sum(bosdmresid^2)/length(bosdmresid))
print(paste("RMSE decomposition additive: ", rmseda))
print(paste("RMSE decomposition multiplicate: ", rmsedm))
```
As we suspected, the multiplicative model has a lower RMSE which means that it is a better fit for the data then the additive model. Thus, I'll use the multiplicative model to make the predictions.
The reason behind the multiplicative model fitting the data better is that the time series we have has a seasonal effect that increases as the trend increases.
**1.b. Fit a trend line to the smoothed deseasonalized series to facilitate forecasting using your choice of model in a.**
Smoothing procedures do not produce a formula that can be extrapolated to give forecasts. But we can fit a line to model the linear trend. We'll use the multiclicative model which yield a higher mrse. Below is the plot of regressing the trend over time:
```{r, echo=FALSE}
tr=window(bos.dm$trend, start=c(1966,7), end=c(1975,4))
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2, main="Linear regression of the trend",ylim=c(-5,450))
lines(ti,fitted(trreg),col='red',lwd=2)
Now that we have our linear model we can use it to forecast values for Nov. 1975 and Dec. 1975:
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = preddata$fit)
```
tail(bos.dm$trend)
# all obs
# aditive
print("With all observations:")
rmseda=sqrt(sum(bos.stla$time.series[,'remainder']^2)/length(bos.stla$time.series[,'remainder']))
# multi
resid=bos.ts-(exp(pred2))
rmsedm=sqrt(sum(resid^2)/length(resid))
print(paste("RMSE loess decomposition additive: ", rmseda))
print(paste("RMSE loess decomposition multiplicate model: ", rmsedm))
```{r, echo=FALSE}
bos.stla=stl(bos.ts,s.window='periodic')
#plot(bos.stla)
pred1=bos.stla$time.series[,'seasonal'] + bos.stla$time.series[,'trend']
plot(bos.ts,lwd=2, main="Loess - Additive")
lines(pred1,col='red',lwd=2)
```
```{r, echo=FALSE}
logbos.ts=log(bos.ts)
#plot(logbos.ts,ylab='log(Boston_crime)')
bos.stlm=stl(logbos.ts,s.window='periodic')
#plot(bos.stlm)
pred2=bos.stlm$time.series[,'seasonal'] + bos.stlm$time.series[,'trend']
plot(logbos.ts,lwd=2,main="Loess - Multiplicative")
lines(pred2,col='red',lwd=2)
```
**2.a. Using both types of fit (additive and multiplicative), determine the best model to fit the data (justify your conclusion both in terms of the characteristics of the data and an evaluation of the fit).**
Again, to check the best fit to the data I'm going to calculate the rmse for both models:
```{r, echo=FALSE}
# all obs
# aditive
print("With all observations:")
rmseda=sqrt(sum(bos.stla$time.series[,'remainder']^2)/length(bos.stla$time.series[,'remainder']))
# multi
resid=bos.ts-(exp(pred2))
rmsedm=sqrt(sum(resid^2)/length(resid))
print(paste("RMSE loess decomposition additive: ", rmseda))
print(paste("RMSE loess decomposition multiplicate model: ", rmsedm))
tr=bos.stlm$time.series[,'trend']
tim=time(tr)
ti = unclass(tim)
# now we perform linear regression
trreg=lm(tr~ti)
plot(tr,lwd=2,ylim=c(3.5,7))
lines(ti,fitted(trreg),col='red',lwd=2)
plot(tr,lwd=2,ylim=c(3.5,6.5))
plot(tr,lwd=2,ylim=c(3.5,6.5))
lines(ti,fitted(trreg),col='red',lwd=2)
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = exp(preddata$fit))
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = exp(preddata$fit))
#tail(bos.stlm$time.series[,'seasonal'],14)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1970,1977),type='l',main="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = exp(preddata$fit))
#tail(bos.stlm$time.series[,'seasonal'],14)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1969,1977),type='l',main="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
```{r, echo=FALSE}
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = exp(preddata$fit))
#tail(bos.stlm$time.series[,'seasonal'],14)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1968,1977),type='l',main="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
predtime=c(1975.833,1975.917)
predtime
preddata=predict(trreg,data.frame(ti=predtime),se.fit=TRUE)
data.frame(Time = c("Nov 1975","Dec 1975"),Prediction = exp(preddata$fit))
#tail(bos.stlm$time.series[,'seasonal'],14)
season=c(0.016314677,0.094040442)
#season
predvalues=preddata$fit
predvalues
spredvalues <- predvalues+season
spredvalues
prederror=preddata$se.fit
predupperse=spredvalues+2*prederror
predlwrse=spredvalues-2*prederror
epredvalues=exp(spredvalues)
epredupperse=exp(predupperse)
epredlwrse=exp(predlwrse)
plot(ti,bos.ts,ylim=c(0,700),xlim=c(1966,1977),type='l',main="Predictions - original scale")
lines(ti,exp(fitted(trreg)),col='red')
points(predtime,epredvalues,col='red',pch=19)
#lines(predtime,epredvalues,col='red',pch=19)
lines(predtime,epredupperse,col='blue',lwd=2)
lines(predtime,epredlwrse,col='blue',lwd=2)
btime=unclass(time(bos.ts))
bseas=cycle(bos.ts)
bdata=coredata(bos.ts)
bosreg=lm(bdata~0+btime+factor(bseas))
summary(bosreg)
boshat=fitted(bosreg)
plot(bos.ts,ylim=c(-5,550))
lines(btime,boshat,col='red')
btime=unclass(time(bos.ts))
bseas=cycle(bos.ts)
bdata=coredata(bos.ts)
bosreg=lm(bdata~0+btime+factor(bseas))
summary(bosreg)
boshat=fitted(bosreg)
plot(bos.ts,ylim=c(-10,550))
lines(btime,boshat,col='red')
```
```{r, echo=FALSE}
btime=unclass(time(bos.ts))
bseas=cycle(bos.ts)
bdata=coredata(bos.ts)
bosreg=lm(bdata~0+btime+factor(bseas))
summary(bosreg)
boshat=fitted(bosreg)
plot(bos.ts,ylim=c(-10,520))
lines(btime,boshat,col='red')
btime
btime=unclass(time(bos.ts))
bseas=cycle(bos.ts)
bdata=coredata(bos.ts)
bosreg=lm(bdata~0+btime+factor(bseas))
summary(bosreg)
boshat=fitted(bosreg)
plot(bos.ts,ylim=c(-20,520))
lines(btime,boshat,col='red',main="Regression model")
btime=unclass(time(bos.ts))
bseas=cycle(bos.ts)
bdata=coredata(bos.ts)
bosreg=lm(bdata~0+btime+factor(bseas))
summary(bosreg)
boshat=fitted(bosreg)
plot(bos.ts,ylim=c(-20,520),main="Regression model")
lines(btime,boshat,col='red')
